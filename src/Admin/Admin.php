<?phpnamespace App\Admin;use App\Model\Database as DB;use App\GlobalClasses\Message;use App\GlobalClasses\Utility;class Admin extends DB{    public $id;    public $category;    public $foodName;    public $foodImage;    public $foodCode;    public $price;    public $deleted_at;        //start of admin login-signup block    public $firstName="";    public $lastName="";    public $email="";    public $phone="";    public $address="";    public $password="";    public $search;    // end of admin login-signup block    public  function __construct()    {        parent::__construct();    }    public function prepare($data=array())    {        if(array_key_exists('id',$data))        {            $this->id=$data['id'];        }        if(array_key_exists('code',$data))        {            $this->foodCode=$data['code'];        }        if(array_key_exists('category',$data))        {            $this->category=$data['category'];        }        if(array_key_exists('food_name',$data))        {            $this->foodName=$data['food_name'];        }        if(array_key_exists('food_image',$data))        {            $this->foodImage=$data['food_image'];        }        if(array_key_exists('price',$data))        {            $this->price=$data['price'];        }                //admin login signup code block start        if(array_key_exists('first_name',$data)){            $this->firstName=$data['first_name'];        }        if(array_key_exists('last_name',$data)){            $this->lastName=$data['last_name'];        }        if(array_key_exists('email',$data)){            $this->email=$data['email'];        }        if(array_key_exists('admin_email',$data)){            $this->email=$data['admin_email'];        }        if(array_key_exists('phone',$data)){            $this->phone=$data['phone'];        }        if(array_key_exists('address',$data)){            $this->address=$data['address'];        }        if(array_key_exists('password',$data)){            $this->password=md5($data['password']);        }        if(array_key_exists('search',$data)){            $this->search=$data['search'];        }                // admin login signup code block end                                                return $this;    }    public function store()    {        if(!empty($this->foodName) && !empty($this->foodImage) && !empty($this->price)) {            $query = "INSERT INTO `fooditem` (`category`, `food_name`, `food_image`, `price`) VALUES ('" . $this->category . "', '" . $this->foodName . "', '" . $this->foodImage . "', '" . $this->price . "')";            $result = mysqli_query($this->conn, $query);            $id = mysqli_insert_id($this->conn);            $_foodCode = 1000 + $id;            $query = "UPDATE `fooditem` SET `food_code`=$_foodCode WHERE `food_name`='" . $this->foodName . "'";            $result = mysqli_query($this->conn, $query);            if ($result) {                Message::message(" <strong>Success!</strong> Item has been inserted successfully.");                Utility::redirect("index.php");            } else {                Message::message(" <strong>Error!</strong>");                Utility::redirect("../Admin/insertMenu.php");            }        }        else{            Message::message(" <strong>Error!</strong> Please enter all data and Try again.");            Utility::redirect("../Admin/insertMenu.php");        }    }    public function getMenueByCategory($category)    {        $_allMenue=array();        $query="SELECT * FROM `fooditem` WHERE `category`='".$category."'";        $result=mysqli_query($this->conn,$query);        while($row=mysqli_fetch_assoc($result))        {            $_allMenue[]=$row;        }        return $_allMenue;    }    public function getTotalMenue()    {        $_allMenue=array();        $query="SELECT * FROM `fooditem`";        $result=mysqli_query($this->conn,$query);        while($row=mysqli_fetch_assoc($result))        {            $_allMenue[]=$row;        }        return $_allMenue;    }    public function getMenuBySearch()    {        $_allMenue=array();        $query="SELECT * FROM `fooditem` WHERE `food_name` LIKE '%".$this->search."%'";        $result=mysqli_query($this->conn,$query);        while($row=mysqli_fetch_assoc($result))        {            $_allMenue[]=$row;        }        return $_allMenue;    }    public function count()    {        $query="SELECT COUNT(*) AS totalItem FROM `fooditem` WHERE `deleted_at` IS NULL";        $result=mysqli_query($this->conn,$query);        $row= mysqli_fetch_assoc($result);        return $row['totalItem'];    }    public function paginator($pageStartFrom=0,$Limit=10){        $_allInfo=array();        $query = "SELECT * FROM `fooditem` WHERE `deleted_at` IS NULL LIMIT ".$pageStartFrom.",".$Limit;        $result = mysqli_query($this->conn, $query);        while($row=mysqli_fetch_assoc($result))        {            $_allInfo[]=$row;        }        return $_allInfo;    }    public function delete()    {        $query="DELETE FROM `restaurant`.`fooditem` WHERE `id`=".$this->id;        $result=mysqli_query($this->conn,$query);        if($result)        {            Message::message("         <strong>Success!</strong> Item has been deleted successfully.        ");            Utility::redirect("index.php");        }        else{            echo "Error!!!";        }    }    public function view()    {        $row = array();        $query = "1 = 1";        if(!empty($this->id)){            $query="SELECT * FROM `fooditem` WHERE `id`=".$this->id;        }        if(!empty($this->foodCode)){            $query="SELECT * FROM `fooditem` WHERE `food_code`=".$this->foodCode;        }                $result=mysqli_query($this->conn,$query);        if($result) $row=mysqli_fetch_assoc($result);        return $row;    }    public function update()    {        if(!empty($this->foodImage))        {            $query="UPDATE `fooditem` SET            `category`='".$this->category."',            `food_name`='".$this->foodName."',            `price`='".$this->price."',            `food_image`= '".$this->foodImage."'            WHERE `id` =".$this->id;//            echo $query;//            die();        }        else{            $query="UPDATE `fooditem` SET            `category`='".$this->category."',            `food_name`='".$this->foodName."',            `price`='".$this->price."'            WHERE `id` =".$this->id;//            echo $query;//            die();        }        $result=mysqli_query($this->conn,$query);        if($result)        {            Message::message("        <strong>Success!</strong> Food Item has been Updated successfully.       ");            Utility::redirect("index.php");        }        else{            echo "Error!!!";        }    }    public function orderCount()    {        $query="SELECT COUNT(*) AS totalItem FROM `orderfood` WHERE `delivery_status` IS NULL";        $result=mysqli_query($this->conn,$query);        $row= mysqli_fetch_assoc($result);        return $row['totalItem'];    }    public function orderPaginator($pageStartFrom=0,$Limit=10)    {        $_allInfo = array();        $query = "SELECT `mappingorder`.`id`,`mappingorder`.`order_id`,`mappingorder`.`food_code`,`mappingorder`.`quantity`,`fooditem`.`food_name`,`orderfood`.`user_id`, `orderfood`.`current_date`,`orderfood`.`payment`,`orderfood`.`transaction_id`,`users`.`first_name`,`users`.`address`                  FROM `mappingorder`                  INNER JOIN `fooditem` ON `mappingorder`.`food_code`=`fooditem`.`food_code`                  INNER JOIN `orderfood` ON `mappingorder`.`order_id`=`orderfood`.`id`                  INNER JOIN `users` ON `users`.`id`=`orderfood`.`user_id`                  ORDER BY `orderfood`.`current_date` DESC                  LIMIT " . $pageStartFrom . "," . $Limit;        $result = mysqli_query($this->conn, $query);        while ($row = mysqli_fetch_assoc($result)) {            $_allInfo[] = $row;        }        return $_allInfo;    }    public function orderDelete($status=array())    {        if(!isset($status))  {            Message::message("        <strong>Empty Selection!</strong>.       ");            return;        }        if(is_array($status)){            $sts= implode(",",$status);            $query="DELETE FROM `mappingorder`  WHERE `mappingorder`.`order_id` IN(".$sts.")";              $result= mysqli_query($this->conn,$query);            $STATUS="DELIVERED";            $query = "UPDATE `orderfood` SET `orderfood`.`delivery_status`='".$STATUS."'                     WHERE `orderfood`.`id` IN(" . $sts . ")";            $result = mysqli_query($this->conn, $query);            }            if($result){                Message::message("        <strong>Success!</strong> Food Item has been Delivered successfully.       ");           //     $_SESSION['message'] = "success";            }            else{                Message::message("        <strong>Error!</strong> Food Item has not been Delivered successfully.       ");           //     $_SESSION['message'] = "failed";            }    //   Utility::redirect("../../../views/Restaurant/Admin/refreshOrderList.php");        //var_dump($_SESSION['message']);                 }    public function orderList()    {        $_allInfo = array();        $query = "SELECT `mappingorder`.`id`,`mappingorder`.`order_id`,`mappingorder`.`food_code`,`mappingorder`.`quantity`,`fooditem`.`food_name`,`orderfood`.`user_id`, `orderfood`.`current_date`                  FROM `mappingorder` INNER JOIN `fooditem` ON `mappingorder`.`food_code`=`fooditem`.`food_code`                  INNER JOIN `orderfood` ON `mappingorder`.`order_id`=`orderfood`.`id`                  ORDER BY `orderfood`.`current_date` DESC";        $result = mysqli_query($this->conn, $query);        while ($row = mysqli_fetch_assoc($result)) {            $_allInfo[] = $row;        }        return $_allInfo;    }// Admin login signup block  start    public function addAdmin(){        $query="INSERT INTO `restaurant`.`admins` (`first_name`, `last_name`, `email`, `password`, `phone`, `address`) VALUES ('".$this->firstName."', '".$this->lastName."', '".$this->email."', '".$this->password."', '".$this->phone."', '".$this->address."')";        $result= mysqli_query($this->conn,$query);        if ($result) {            Message::message("<strong>Success!</strong> Data has been stored successfully.");            return Utility::redirect($_SERVER['HTTP_REFERER']);        } else {            Message::message("                            <strong>Fail!</strong> Data has not been stored successfully.                ");            return Utility::redirect($_SERVER['HTTP_REFERER']);        }    }    public function change_password(){        $query="UPDATE `restaurant`.`admins` SET `password`='".$this->password."'  WHERE `admins`.`email` = "."'".$this->email."'";        //  Utility::dd($query);        $result=mysqli_query($this->conn,$query);        if($result){            Message::message("             <div class=\"alert alert-info\">             <strong>Success!</strong> Password has been updated  successfully.              </div>");        }        else {            echo "Error";        }        return Utility::redirect($_SERVER['HTTP_REFERER']);    }    public function updateAdmin(){        $query="UPDATE `restaurant`.`admins` SET `first_name`='".$this->firstName."', `last_name` = '".$this->lastName."' , `email` = '".$this->email."' , `phone` = '".$this->phone."' , `address` = '".$this->address."'   WHERE `admins`.`email` = "."'".$this->email."'";        //  Utility::dd($query);        $result=mysqli_query($this->conn,$query);        if($result){            Message::message("             <div class=\"alert alert-info\">             <strong>Success!</strong> Data has been updated  successfully.              </div>");        }        else {            echo "Error";        }        return Utility::redirect($_SERVER['HTTP_REFERER']);    }    public function viewAdmin(){        $query="SELECT * FROM `admins` WHERE `email`='".$_SESSION['admin_email']."'";        $result= mysqli_query($this->conn,$query);        $row= mysqli_fetch_object($result);        return $row;    }// end of view()// Admin login signup block end   public function isExistOnMap($order_id){       $query="SELECT * FROM `mappingorder`  WHERE `mappingorder`.`order_id` = ".$order_id;       $result= mysqli_query($this->conn,$query);       $countRows= mysqli_num_rows($result);       if($countRows>0)           return False;       else           return True;   }                    }